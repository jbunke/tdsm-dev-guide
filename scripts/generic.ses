(~ string[] IDs, ~ {string:int} incidence, ~ string folder, ~ layer l) {
    ~ string art_folder = "../bases/" + folder + "/";
    ~ int to_save = #| IDs;

    string csv = "";

    for (int i = 0; i < to_save; i++) {
        ~ string id = IDs[i];
        ~ image content = l.get_cel(i);

        write_image(art_folder + id + ".png", content);

        csv += csv_entry(id, incidence);
        csv += (i + 1 < to_save) ? "," : "\n";
    }

    write_file(art_folder + folder + ".csv", csv);
}

csv_entry(~ string id, ~ {string:int} incidence -> string) -> 
        id + (incidence.has(id) ? ":" + incidence.lookup(id) : "")
